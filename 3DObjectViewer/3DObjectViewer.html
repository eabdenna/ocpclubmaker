<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>3D Object Viewer</title>
		<link rel="stylesheet" type="text/css" href="3DObjectViewer.css">
		<meta name="theme-color" content="#3f729b"/>
		<meta name="viewport" content="width=380, initial-scale=1, maximum-scale=1"/>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.0.7/css/swiper.min.css'><link rel="stylesheet" href="./style.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prefixfree/1.0.7/prefixfree.min.js"></script>
<link href="../assets/img/favicon.png" rel="icon">
<link href="../assets/vendor/icofont/icofont.min.css" rel="stylesheet">

<link href="../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../assets/img/apple-touch-icon.png" rel="apple-touch-icon">
  <link href="../assets/css/style.css" rel="stylesheet">
  <link href="../assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="../assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="../assets/vendor/venobox/venobox.css" rel="stylesheet">
  <link href="../assets/vendor/owl.carousel/assets/owl.carousel.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
	</head>
	<style>
		 body {
              background-image: url('../assets/img/stl.jpg');
              background-repeat: no-repeat;
              background-attachment: fixed; 
              background-size: 100% 100%;
            }
	</style>
	<header id="header" class="fixed-top header-inner-pages">
		<div class="container-fluid">
	  
		  <div class="row justify-content-center">
			<div class="col-xl-9 d-flex align-items-center justify-content-between">
			  <h1 class="logo"><a href="../index.html">OCP CLub Maker</a></h1>
			  <!-- Uncomment below if you prefer to use an image logo -->
			  <!-- <a href="index.html" class="logo"><img src="assets/img/logo.png" alt="" class="img-fluid"></a>-->
	  
			  <nav class="nav-menu d-none d-lg-block">
				<ul>
				  <li><a href="../index.html#services">PRÉSENTATION</a></li>
				  
				  <li class="drop-down"><a href="../index.html#service">CLUBS</a>
					<ul>
						<li><a href="../astro/index.html">L'astronomie</a></li>
						<li><a href="../plane/index.html">Aéronautique</a></li>
						<li><a href="../autonplanner/index.html">Robotique</a></li>
						<li><a href="../3DObjectViewer/3DObjectViewer.html">3D</a></li>
					</ul>
				  </li>
				  <li><a href="../index.html#services">VIDÉOS</a></li>
				  <li><a href="../index.html#portfolio">EQUIPEMENTS</a></li>
				  <li><a href="../index.html#pricing">AGENDA</a></li>
				  <li><a href="../index.html#contact">E-LEARNING</a></li>
	  
				  <li><a href="../index.html#contact">CONTACT</a></li>
	  
				</ul>
			  </nav><!-- .nav-menu -->
	  
			</div>
		  </div>
	  
		</div>
	  </header>
	<body>
		<div id="loading" class="loading_splash">
			<div class="loading_splash_container">
				<div class="lds-spinner"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>
			</div>
		</div>
		<div class="content">
			<div id="container"></div>
			<div id="container2">
				<span id="densityLabel"></span>:&nbsp;<span id="densityValue"></span>&nbsp;g/cc&nbsp;<input type="submit" class="buttonChanger" onclick="moreDensity(true);" value="+"/>&nbsp;<input type="submit" class="buttonChanger" onclick="moreDensity(false);" value="-"/><br />
				<span id="weightLabel"></span>:&nbsp;<span id="weightValue"></span>&nbsp;g<br />
				<span id="volumeLabel"></span>:&nbsp;<span id="volumeValue"></span>&nbsp;cm3<br />
				<span id="sizeLabel"></span>:&nbsp;<span id="widthValue"></span>&nbsp;x&nbsp;<span id="heightValue"></span>&nbsp;x&nbsp;<span id="depthValue"></span>&nbsp;cm<br />
				<hr class="separator"/>
				<span id="costKilogramLabel"></span>:&nbsp;$<span id="costKilogramValue"></span>&nbsp;<input type="submit" class="buttonChanger" onclick="moreCost(true);" value="+"/>&nbsp;<input type="submit" class="buttonChanger" onclick="moreCost(false);" value="-"/><br />
				<span id="costLabel"></span>:&nbsp;$<span id="costValue"></span><br />
				<hr class="separator"/>
				<span id="diameterLabel"></span>:&nbsp;<span id="diameterValue"></span>&nbsp;mm&nbsp;<input type="submit" class="buttonChanger" onclick="moreDiameter(true);" value="+"/>&nbsp;<input type="submit" class="buttonChanger" onclick="moreDiameter(false);" value="-"/><br />
				<span id="speedLabel"></span>:&nbsp;<span id="speedValue"></span>&nbsp;mm/s&nbsp;<input type="submit" class="buttonChanger" onclick="moreSpeed(true);" value="+"/>&nbsp;<input type="submit" class="buttonChanger" onclick="moreSpeed(false);" value="-"/><br />
				<span id="lengthLabel"></span>:&nbsp;<span id="lengthValue"></span>&nbsp;mm<br />
				<span id="timeLabel"></span>:&nbsp;<span id="hoursValue"></span>&nbsp;<span id="hoursLabel"></span>&nbsp;<span id="minutesValue"></span>&nbsp;<span id="minutesLabel"></span><br />
			</div>
			<div class="container3">
				<div class="leftitem">
					<input type="file" id="modelOBJ" onChange="runViewer();" disabled>
				</div>
			</div>
		</div>

		 <script src="3DObjectViewer.js"></script>
		 <script>

			// THE BROWSER LANGUAGE VARIABLE
			var userLanguage = window.navigator.userLanguage || window.navigator.language;

			var STRING_ERROR = "";

			if (userLanguage.substring(0,2)=="es")
				{
				STRING_ERROR = "ERROR: Por favor verifique que el modelo se encuentre en formato STL, OBJ o 3DS.";
				}
				else
				{
				STRING_ERROR = "ERROR: Please check that the model is a STL, OBJ or 3DS model.";
				}

			var container, camera, scene, renderer, controls, light, vol, mesh, height, heightFinal, width, widthFinal, depth, depthFinal;

			var density = parseFloat("1.05");
			var filament_cost = parseFloat("200");
			var filament_diameter = parseFloat("1.75");
			var printing_speed = parseFloat("150");

			if (userLanguage.substring(0,2)=="es")
				{
				document.getElementById("densityLabel").innerHTML = "Densidad";
				document.getElementById("weightLabel").innerHTML = "Peso";
				document.getElementById("volumeLabel").innerHTML = "Volumen";
				document.getElementById("sizeLabel").innerHTML = "Medidas";
				document.getElementById("costKilogramLabel").innerHTML = "Costo de 1 kilogramo de filamento";
				document.getElementById("costLabel").innerHTML = "Costo de impresi&oacute;n";
				document.getElementById("diameterLabel").innerHTML = "Di&aacute;metro del filamento";
				document.getElementById("speedLabel").innerHTML = "Velocidad de impresi&oacute;n";
				document.getElementById("lengthLabel").innerHTML = "Longitud de filamento";
				document.getElementById("timeLabel").innerHTML = "Tiempo de impresi&oacute;n";
				document.getElementById("hoursLabel").innerHTML = "horas";
				document.getElementById("minutesLabel").innerHTML = "minutos";
				}
				else
				{
				document.getElementById("densityLabel").innerHTML = "Density";
				document.getElementById("weightLabel").innerHTML = "Weight";
				document.getElementById("volumeLabel").innerHTML = "Volume";
				document.getElementById("sizeLabel").innerHTML = "Size";
				document.getElementById("costKilogramLabel").innerHTML = "Filament cost per kilogram";
				document.getElementById("costLabel").innerHTML = "Printing cost";
				document.getElementById("diameterLabel").innerHTML = "Filament diameter";
				document.getElementById("speedLabel").innerHTML = "Printing speed";
				document.getElementById("lengthLabel").innerHTML = "Filament length";
				document.getElementById("timeLabel").innerHTML = "Build time";
				document.getElementById("hoursLabel").innerHTML = "hours";
				document.getElementById("minutesLabel").innerHTML = "minutes";
				}

			function init(file)
				{
				container = document.getElementById("container");
				container.innerHTML= "";

				camera = new THREE.PerspectiveCamera(37.8,window.innerWidth/window.innerHeight,1,100000);

				camera.position.z=300;
				camera.position.y=-500;
				camera.position.x=-500;
				camera.up=new THREE.Vector3(0,0,1);

				scene = new THREE.Scene();
				scene.background = new THREE.Color(0x303030);

				var filename = file.name;
				var extension = filename.split(".").pop().toLowerCase();
				var reader = new FileReader();

				document.getElementById("container2").style.display="none";

				if (extension=="stl")
					{
					// SHOWING THE LOADING SPLASH
					document.getElementById("loading").style.display = "block";

					// GIVES TIME TO THE UI TO SHOW THE LOADING SPLASH
					setTimeout(function()
						{
						reader.readAsArrayBuffer(file);
						}, 500);
					}
				else if (extension=="3ds")
					{
					// SHOWING THE LOADING SPLASH
					document.getElementById("loading").style.display = "block";

					// GIVES TIME TO THE UI TO SHOW THE LOADING SPLASH
					setTimeout(function()
						{
						reader.readAsArrayBuffer(file);
						}, 500);
					}
				else if (extension=="obj")
					{
					// SHOWING THE LOADING SPLASH
					document.getElementById("loading").style.display = "block";

					// GIVES TIME TO THE UI TO SHOW THE LOADING SPLASH
					setTimeout(function()
						{
						reader.readAsText(file);
						}, 500);
					}
					else
					{
					// HIDDING THE LOADING SPLASH
					document.getElementById("loading").style.display = "none";

					document.getElementById("container2").style.display="none";
					alert(STRING_ERROR);
					}

				reader.addEventListener("load", function (event)
					{
					try
						{
						var contents = event.target.result;
						if (extension=="obj")
							{
							var object = new THREE.OBJLoader().parse(contents);
							var sceneConverter = new THREE.Scene();
							sceneConverter.add(object);
							var exporter = new THREE.STLExporter();
							contents = exporter.parse(sceneConverter);
							}
						else if (extension=="3ds")
							{
							var object = new THREE.TDSLoader().parse(contents);
							var sceneConverter = new THREE.Scene();
							sceneConverter.add(object);
							var exporter = new THREE.STLExporter();
							contents = exporter.parse(sceneConverter);
							}

						var geometry = new THREE.STLLoader().parse(contents);
						geometry.computeFaceNormals();
						geometry.computeVertexNormals();
						geometry.center();

						var material = new THREE.MeshPhongMaterial({color:0xffffff});
						mesh = new THREE.Mesh(geometry, material);

						// CALCULATING THE VOLUME
						vol = 0;

						mesh.traverse(function (child)
							{
							if (child instanceof THREE.Mesh)
								{
								var positions = child.geometry.getAttribute("position").array;
								for(var i=0;i<positions.length; i+=9)
									{
									var t1 = {};
									t1.x = positions[i+0];
									t1.y = positions[i+1];
									t1.z = positions[i+2];

									var t2 = {};
									t2.x = positions[i+3];
									t2.y = positions[i+4];
									t2.z = positions[i+5];

									var t3 = {};
									t3.x = positions[i+6];
									t3.y = positions[i+7];
									t3.z = positions[i+8];

									vol += signedVolumeOfTriangle(t1,t2,t3);
									}
								}
							});

						var box = new THREE.Box3().setFromObject(mesh);

						height = box.max.z - box.min.z;
						width = box.max.x - box.min.x;
						depth = box.max.y - box.min.y;

						heightFinal = height / 10;heightFinal = heightFinal.toFixed(2);
						widthFinal = width / 10;widthFinal = widthFinal.toFixed(2);
						depthFinal = depth / 10;depthFinal = depthFinal.toFixed(2);
						var volumeFinal = vol / 1000;volumeFinal = volumeFinal.toFixed(2);
						var weightFinal = volumeFinal * density;weightFinal = weightFinal.toFixed(2);

						var filament_length = parseFloat(( vol / ( filament_diameter / 2 ) ^ 2 / Math.PI ) * 2 / 10).toFixed(2);
						filament_length = parseFloat(filament_length).toFixed(0);

						var hours = Math.floor((filament_length / printing_speed) / 60);
						hours = parseFloat(hours).toFixed(0);

						var minutes = (filament_length / printing_speed) % 60;
						minutes = parseFloat(minutes).toFixed(0);

						if (minutes==0){minutes=1;}

						var finalCost = weightFinal * filament_cost / 1000;
						finalCost = parseFloat(finalCost).toFixed(2);

						document.getElementById("container2").style.display="block";
						document.getElementById("densityValue").innerHTML = density;
						document.getElementById("weightValue").innerHTML = weightFinal;
						document.getElementById("volumeValue").innerHTML = volumeFinal;
						document.getElementById("widthValue").innerHTML = widthFinal; 
						document.getElementById("depthValue").innerHTML = depthFinal;
						document.getElementById("heightValue").innerHTML = heightFinal;
						document.getElementById("costKilogramValue").innerHTML = filament_cost;
						document.getElementById("costValue").innerHTML = finalCost;
						document.getElementById("diameterValue").innerHTML = filament_diameter;
						document.getElementById("speedValue").innerHTML = printing_speed;
						document.getElementById("lengthValue").innerHTML = filament_length;
						document.getElementById("hoursValue").innerHTML = hours;
						document.getElementById("minutesValue").innerHTML = minutes;

						var distance;

						if (height>width && height>depth)
							{
							distance = height * 2;
							}
						else if (width>height && width>depth)
							{
							distance = width * 2;
							}
						else if (depth>height && depth>width)
							{
							distance = depth * 2;
							}
						else
							{
							distance = depth * 4;
							}

						camera.position.set(0, -distance, 0);

						var x = distance + 200;
						var y = distance + 200;
						var division_x=Math.floor(x/10);
						var division_y=Math.floor(y/10);

						var wirePlane=new THREE.Mesh(new THREE.PlaneGeometry(x,y,division_x,division_y),new THREE.MeshPhongMaterial({emissive:0x707070,color:0x000000,wireframe:true,wireframeLinewidth:1}));
						wirePlane.receiveShadow=true;
						wirePlane.position.z = box.min.z - 0.1;
						scene.add(wirePlane);

						// AN ALTERNATIVE FOR MOVING THE OBJECT USING THE MOUSE WITHIN THE RENDERER
						// controls = new THREE.OrbitControls(camera, renderer.domElement);
						controls = new THREE.OrbitControls(camera);
						controls.update();

						scene.add(mesh);

						// HIDDING THE LOADING SPLASH
						document.getElementById("loading").style.display = "none";
						}
						catch(err)
						{
						// HIDDING THE LOADING SPLASH
						document.getElementById("loading").style.display = "none";

						document.getElementById("container2").style.display="none";
						alert(STRING_ERROR);
						}
					}, false);

				light = new THREE.HemisphereLight(0xE8E8E8,0x000000,1);
				light.position.set(0,0,0);
				scene.add(light);

				renderer = new THREE.WebGLRenderer({antialias:false});
				renderer.setSize(window.innerWidth,window.innerHeight);
				container.appendChild(renderer.domElement);

				requestAnimationFrame(animate);

				window.addEventListener("resize", onWindowResize, false );
				}

			function animate()
				{
				requestAnimationFrame(animate);
				light.position.copy(camera.getWorldPosition());
				renderer.render(scene,camera);
				}

			function onWindowResize()
				{
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize(window.innerWidth, window.innerHeight);
				}

			function moreDensity(a)
				{
				var result;
				if (a==true)
					{
					result = parseFloat(density) + parseFloat("0.05");
					if (result<=10000)
						{
						density = result;
						}
					}
					else
					{
					result = parseFloat(density) - parseFloat("0.05");
					if (result>0)
						{
						density = result;
						}
					}

				density = parseFloat(density).toFixed(2);

				var heightFinal = height / 10;heightFinal = heightFinal.toFixed(2);
				var widthFinal = width / 10;widthFinal = widthFinal.toFixed(2);
				var depthFinal = depth / 10;depthFinal = depthFinal.toFixed(2);
				var volumeFinal = vol / 1000;volumeFinal = volumeFinal.toFixed(2);
				var weightFinal = volumeFinal * density;weightFinal = weightFinal.toFixed(2);

				document.getElementById("densityValue").innerHTML = density;
				document.getElementById("weightValue").innerHTML = weightFinal;
				document.getElementById("volumeValue").innerHTML = volumeFinal;
				document.getElementById("widthValue").innerHTML = widthFinal; 
				document.getElementById("depthValue").innerHTML = depthFinal;
				document.getElementById("heightValue").innerHTML = heightFinal;
				updateCost();
				}

			function moreCost(a)
				{
				var result;
				if (a==true)
					{
					result = parseFloat(filament_cost) + parseFloat("5");
					if (result<=10000)
						{
						filament_cost = result;
						}
					}
					else
					{
					result = parseFloat(filament_cost) - parseFloat("5");
					if (result>0)
						{
						filament_cost = result;
						}
					}
				document.getElementById("costKilogramValue").innerHTML = filament_cost;

				updateCost();
				}

			function updateCost()
				{
				var volumeFinal = vol / 1000;volumeFinal = volumeFinal.toFixed(2);
				var weightFinal = volumeFinal * density;weightFinal = weightFinal.toFixed(2);
				var finalCost = weightFinal * filament_cost / 1000;
				finalCost = parseFloat(finalCost).toFixed(2);
				document.getElementById("costValue").innerHTML = finalCost;
				}

			function moreDiameter(a)
				{
				var result;
				if (a==true)
					{
					result = parseFloat(filament_diameter) + parseFloat("0.05");
					if (result<=10000)
						{
						filament_diameter = result;
						}
					}
					else
					{
					result = parseFloat(filament_diameter) - parseFloat("0.05");
					if (result>0)
						{
						filament_diameter = result;
						}
					}

				filament_diameter = parseFloat(filament_diameter).toFixed(2);

				var filament_length = parseFloat(( vol / ( filament_diameter / 2 ) ^ 2 / Math.PI ) * 2 / 10).toFixed(2);
				filament_length = parseFloat(filament_length).toFixed(0);

				var hours = Math.floor((filament_length / printing_speed) / 60);
				hours = parseFloat(hours).toFixed(0);

				var minutes = (filament_length / printing_speed) % 60;
				minutes = parseFloat(minutes).toFixed(0);

				if (minutes==0){minutes=1;}

				document.getElementById("diameterValue").innerHTML = filament_diameter;
				document.getElementById("lengthValue").innerHTML = filament_length;
				document.getElementById("hoursValue").innerHTML = hours;
				document.getElementById("minutesValue").innerHTML = minutes;
				}

			function moreSpeed(a)
				{
				var result;
				if (a==true)
					{
					result = parseFloat(printing_speed) + parseFloat("5");
					if (result<=10000)
						{
						printing_speed = result;
						}
					}
					else
					{
					result = parseFloat(printing_speed) - parseFloat("5");
					if (result>0)
						{
						printing_speed = result;
						}
					}

				printing_speed = parseFloat(printing_speed).toFixed(0);

				var filament_length = parseFloat(( vol / ( filament_diameter / 2 ) ^ 2 / Math.PI ) * 2 / 10).toFixed(2);

				var hours = Math.floor((filament_length / printing_speed) / 60);
				hours = parseFloat(hours).toFixed(0);

				var minutes = (filament_length / printing_speed) % 60;
				minutes = parseFloat(minutes).toFixed(0);

				document.getElementById("speedValue").innerHTML = printing_speed;
				document.getElementById("hoursValue").innerHTML = hours;
				document.getElementById("minutesValue").innerHTML = minutes;
				}

			function runViewer()
				{
				var fileInput = document.getElementById("modelOBJ");
				if (fileInput.files[0]!=null)
					{
					init(fileInput.files[0]);
					fileInput.value = null;
					}
				}

			window.onload = function()
				{
				document.getElementById("modelOBJ").disabled = false;
				document.getElementById("modelOBJ").value = null;
				}
		</script>
		 <script src='https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.4.1/js/swiper.min.js'></script>
		 <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js'></script>
		 <script src='https://s3-us-west-2.amazonaws.com/s.cdpn.io/191814/lazysizes.min.js'></script><script  src="./script.js"></script>
		 <script src="../assets/vendor/jquery/jquery.min.js"></script>
		 <script src="../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
		 <script src="../assets/vendor/jquery.easing/jquery.easing.min.js"></script>
		 <script src="../assets/vendor/php-email-form/validate.js"></script>
		 <script src="../assets/vendor/waypoints/jquery.waypoints.min.js"></script>
		 <script src="../assets/vendor/counterup/counterup.min.js"></script>
		 <script src="../assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
		 <script src="../assets/vendor/venobox/venobox.min.js"></script>
		 <script src="../assets/vendor/owl.carousel/owl.carousel.min.js"></script>
		 
		 <!-- Template Main JS File -->
		 <script src="../assets/js/main.js"></script>
	</body>
</html>